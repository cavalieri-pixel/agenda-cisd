// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 1. Los Profesionales (Con soporte para Login)
model Professional {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique // Obligatorio para el Login
  // La contrase√±a tiene un valor por defecto para que no falle con los usuarios que ya existen
  password  String   @default("$2a$10$cw/somehashedstring") 
  color     String   @default("#3788d8")
  
  appointments Appointment[]
  schedules    Schedule[]
  createdAt    DateTime      @default(now())
}

// 2. Los Servicios
model Service {
  id          Int      @id @default(autoincrement())
  code        String   @unique
  name        String
  durationMin Int      @default(30)
  price       Int?
  isTelemed   Boolean  @default(false)
  appointments Appointment[]
}

// 3. Los Pacientes
model Patient {
  id           Int      @id @default(autoincrement())
  rut          String   @unique
  name         String
  email        String?
  phone        String?
  appointments Appointment[]
  createdAt    DateTime @default(now())
}

// 4. Las Citas
model Appointment {
  id             Int          @id @default(autoincrement())
  startTime      DateTime
  endTime        DateTime
  status         String       @default("CONFIRMED")
  
  professional   Professional @relation(fields: [professionalId], references: [id])
  professionalId Int
  
  patient        Patient      @relation(fields: [patientId], references: [id])
  patientId      Int
  
  service        Service?     @relation(fields: [serviceId], references: [id])
  serviceId      Int?

  meetLink       String?
  googleEventId  String?
  createdAt      DateTime     @default(now())
}

// 5. Horarios
model Schedule {
  id             Int          @id @default(autoincrement())
  professional   Professional @relation(fields: [professionalId], references: [id])
  professionalId Int
  dayOfWeek      Int
  startTime      String
  endTime        String
}