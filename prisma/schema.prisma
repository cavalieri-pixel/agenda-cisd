// This is your Prisma schema file

generator client {
  provider = "prisma-client-js" 
  // Antes decía solo "prisma-client", eso estaba mal.
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL") 
  // Esta línea es CRÍTICA: le dice a Prisma que lea tu link de Neon desde el archivo .env
}

// 1. Los Profesionales (Fernanda, Bastian, etc.)
model Professional {
  id           Int           @id @default(autoincrement())
  name         String
  email        String?       @unique
  password     String?       // Para el login futuro
  color        String        @default("#3788d8") // El color para el calendario
  appointments Appointment[]
  schedules    Schedule[]    // Sus horarios de atención
  createdAt    DateTime      @default(now())
}

// 2. Los Servicios (Fonoaudiología, etc.)
model Service {
  id           Int           @id @default(autoincrement())
  code         String        @unique // Ej: FA-DOM-ALR
  name         String        // Ej: Atención Fonoaudiología Adulto
  durationMin  Int           @default(30)
  price        Int?
  isTelemed    Boolean       @default(false) // Si es true, genera Meet
  appointments Appointment[]
}

// 3. Los Pacientes
model Patient {
  id           Int           @id @default(autoincrement())
  rut          String        @unique
  name         String
  email        String?
  phone        String?
  appointments Appointment[]
  createdAt    DateTime      @default(now())
}

// 4. Las Citas (El corazón del sistema)
model Appointment {
  id             Int          @id @default(autoincrement())
  startTime      DateTime     // Fecha y hora inicio
  endTime        DateTime     // Fecha y hora fin
  status         String       @default("CONFIRMED") // CONFIRMED, CANCELLED, ATTENDED
  
  professional   Professional @relation(fields: [professionalId], references: [id])
  professionalId Int
  
  patient        Patient      @relation(fields: [patientId], references: [id])
  patientId      Int
  
  service        Service?     @relation(fields: [serviceId], references: [id])
  serviceId      Int?

  meetLink       String?      // Link de Google Meet generado
  googleEventId  String?      // ID para sincronizar con Google Calendar
  createdAt      DateTime     @default(now())
}

// 5. Horarios fijos de los profesionales
model Schedule {
  id             Int          @id @default(autoincrement())
  professional   Professional @relation(fields: [professionalId], references: [id])
  professionalId Int
  dayOfWeek      Int          // 1=Lunes, 2=Martes...
  startTime      String       // "09:00"
  endTime        String       // "20:00"
}